(self.webpackChunkcap=self.webpackChunkcap||[]).push([[5843],{5843:(t,e,i)=>{"use strict";i.r(e),i.d(e,{PodPageModule:()=>A});var o=i(1116),r=i(1041),s=i(5394),a=i(3146),n=i(4762),l=i(9609),d=i(5724),u=i(8194),c=i(3148),p=i(5614),h=i(8579);function T(t,e){if(1&t&&(p.TgZ(0,"ion-chip",14),p.TgZ(1,"ion-label"),p._uU(2),p.ALo(3,"date"),p.qZA(),p._UZ(4,"ion-icon",15),p.qZA()),2&t){const t=p.oxw(2);p.xp6(2),p.hij(" ",p.xi3(3,1,t.deliverDateTime,"dd-MM-yyyy HH:mm")," ")}}function Z(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"ion-content",3),p.TgZ(1,"ion-card",4),p.TgZ(2,"ion-card-content",5),p.TgZ(3,"table",6),p.TgZ(4,"tr"),p.TgZ(5,"th"),p.TgZ(6,"ion-label",7),p._uU(7,"Customer"),p.qZA(),p.qZA(),p.TgZ(8,"td"),p.TgZ(9,"b"),p._uU(10),p.qZA(),p.qZA(),p.qZA(),p.TgZ(11,"tr"),p.TgZ(12,"th"),p.TgZ(13,"ion-label",7),p._uU(14,"Document"),p.qZA(),p.qZA(),p.TgZ(15,"td"),p.TgZ(16,"b"),p._uU(17),p.qZA(),p.qZA(),p.qZA(),p.TgZ(18,"tr"),p.TgZ(19,"th"),p.TgZ(20,"ion-label",7),p._uU(21,"Total Qty"),p.qZA(),p.qZA(),p.TgZ(22,"td"),p.TgZ(23,"b"),p._uU(24),p.qZA(),p.qZA(),p.qZA(),p.TgZ(25,"tr"),p.TgZ(26,"th"),p.TgZ(27,"ion-label",7),p._uU(28,"Weight"),p.qZA(),p.qZA(),p.TgZ(29,"td"),p.TgZ(30,"b"),p._uU(31),p.qZA(),p.qZA(),p.qZA(),p.TgZ(32,"tr"),p.TgZ(33,"th"),p.TgZ(34,"ion-label",7),p._uU(35,"Volume"),p.qZA(),p.qZA(),p.TgZ(36,"td"),p.TgZ(37,"b"),p._uU(38),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(39,"ion-card",4),p.TgZ(40,"ion-card-content",8),p.TgZ(41,"ion-row"),p.TgZ(42,"ion-col",9),p.NdJ("click",function(){return p.CHM(t),p.oxw().delivery()}),p._UZ(43,"img",10),p.TgZ(44,"ion-text",7),p.TgZ(45,"p",11),p.TgZ(46,"b"),p._uU(47,"Delivery"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(48,"ion-col",12),p.YNc(49,T,5,4,"ion-chip",13),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&t){const t=e.$implicit,i=p.oxw();p.xp6(10),p.AsE("",t.XBPCORD_0," - ",t.XBPNAME_0,""),p.xp6(7),p.Oqu(t.XDOCNUM_0),p.xp6(7),p.AsE("",t.TQTY_0?t.TQTY_0:"0"," ",t.SAU_0,""),p.xp6(7),p.AsE("",t.DSPTOTWEI_0?t.DSPTOTWEI_0:"0"," ",t.DSPWEU_0,""),p.xp6(7),p.AsE("",t.DSPTOTVOL_0?t.DSPTOTVOL_0:"0"," ",t.DSPVOU_0,""),p.xp6(11),p.Q6J("ngIf",i.podModel.delivery)}}const g=[{path:"",component:(()=>{class t{constructor(t,e,i,o){this.routesService=t,this.route=e,this.utilService=i,this.router=o,this.pod=[],this.podModel={confirm_arrival:"",start_unload:"",delivery:"",end_unload:"",departure:""},this.route.queryParams.subscribe(t=>{t&&t.poddet&&(this.podId=t.poddet,this.getPod())})}ngOnInit(){}getPod(){return(0,n.mG)(this,void 0,void 0,function*(){let t=localStorage.getItem("activeRouteId");yield this.utilService.showLoading(),(0,c.D)({pod:this.routesService.getPod(this.podId),currentStop:this.routesService.getStops(t)}).subscribe(t=>{var e,i,o,r,s,a;if(this.utilService.dismissLoading(),this.pod=t.pod,this.currentStop=u.find(t.currentStop,{XDOCNUM_0:this.podId}),(null===(i=null===(e=this.currentStop)||void 0===e?void 0:e.XARRTIM_0)||void 0===i?void 0:i.length)>1){let t=l(this.currentStop.XARRVDAT_0).format("YYYY-MM-DD"),e=new Date(t+" "+this.currentStop.XARRTIM_0);this.podModel.confirm_arrival=e}if((null===(o=this.currentStop)||void 0===o?void 0:o.XSTARTULTIM_0.length)>1){let t=l(this.currentStop.XSTARTULDAT_0).format("YYYY-MM-DD"),e=new Date(t+" "+this.currentStop.XSTARTULTIM_0);this.podModel.start_unload=e}if(6==(null===(r=this.currentStop)||void 0===r?void 0:r.XSTATUS_0)){let t=l(this.currentStop.XFINDAT_0).format("YYYY-MM-DD"),e=new Date(t+" "+this.currentStop.XFINTIME_0);this.podModel.delivery="Delivered",this.deliverDateTime=e}if((null===(s=this.currentStop)||void 0===s?void 0:s.XENDULTIM_0.length)>1){let t=l(this.currentStop.XENDULDAT_0).format("YYYY-MM-DD"),e=new Date(t+" "+this.currentStop.XENDULTIM_0);this.podModel.end_unload=e}if((null===(a=this.currentStop)||void 0===a?void 0:a.XDEPTIM_0.length)>1){let t=l(this.currentStop.XDEPDAT_0).format("YYYY-MM-DD"),e=new Date(t+" "+this.currentStop.XDEPTIM_0);this.podModel.departure=e}},t=>{this.utilService.dismissLoading(),this.utilService.showErrorCall(t)})})}setDate(t){switch(t){case"confirm_arrival":this.updatePODStatus(t);break;case"start_unload":this.podModel.confirm_arrival?this.updatePODStatus(t):this.utilService.showToast("Please complete above step first.");break;case"end_unload":this.podModel.delivery&&this.podModel.confirm_arrival&&this.podModel.start_unload?this.updatePODStatus(t):this.utilService.showToast("Please complete above step first.");break;case"departure":this.podModel.delivery&&this.podModel.confirm_arrival&&this.podModel.start_unload&&this.podModel.end_unload?this.updatePODStatus(t):this.utilService.showToast("Please complete above step first.")}}updatePODStatus(t){this.podModel[t]?this.utilService.showToast("Already Completed!"):this.utilService.showConfirmationPopup("Confirmation","Are you sure you want to "+t.replace("_"," ")+"?",e=>(0,n.mG)(this,void 0,void 0,function*(){if(1==e){if(this.postParams={doc:this.podId,status_type:t,datetime:l().format("YYYY-MM-DDTHH:mm:ss")},"confirm_arrival"==t){if(!d.f.currentPos.lat||!d.f.currentPos.lng)return this.utilService.showToast(),!1;this.postParams.latitude=d.f.currentPos.lat,this.postParams.longitude=d.f.currentPos.lng}"confirm_arrival"!=t&&"departure"!=t||(this.postParams.route_no=localStorage.getItem("activeRouteId")),yield this.utilService.showLoading(),this.routesService.postStatus(this.postParams).subscribe(e=>{this.utilService.dismissLoading(),this.podModel[t]=new Date,"departure"==t&&this.router.navigate(["/tabs/stop-list"])},t=>{this.utilService.dismissLoading(),this.utilService.showErrorCall(t)})}}))}delivery(){6==this.currentStop.XSTATUS_0?this.utilService.showToast("Product already delivered!"):this.router.navigate(["/tabs/stop-list/stop-detail/pod/capture-details"],{queryParams:{podId:this.podId}})}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(h._),p.Y36(a.gz),p.Y36(d.f),p.Y36(a.F0))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-pod"]],decls:7,vars:1,consts:[["color","dark"],["slot","start"],["color","tertiary",4,"ngFor","ngForOf"],["color","tertiary"],[1,"m-3"],[1,"p-2"],[1,"table","table-sm","table-borderless","mb-0","fs-14"],["color","primary"],[1,"p-0"],["size","5",1,"ion-text-center","bg-light",3,"click"],["src","assets/images/delivery.png","alt","","width","40px"],[1,"pt-1"],["size","7",1,"d-flex-center"],["color","success",4,"ngIf"],["color","success"],["name","checkmark-circle"]],template:function(t,e){1&t&&(p.TgZ(0,"ion-header"),p.TgZ(1,"ion-toolbar",0),p.TgZ(2,"ion-buttons",1),p._UZ(3,"ion-back-button"),p.qZA(),p.TgZ(4,"ion-title"),p._uU(5,"POD"),p.qZA(),p.qZA(),p.qZA(),p.YNc(6,Z,50,10,"ion-content",2)),2&t&&(p.xp6(6),p.Q6J("ngForOf",e.pod))},directives:[s.Gu,s.sr,s.Sm,s.oU,s.cs,s.wd,o.sg,s.W2,s.PM,s.FN,s.Q$,s.Nd,s.wI,s.yW,o.O5,s.hM,s.gu],pipes:[o.uU],styles:[""]}),t})()},{path:"capture-details",loadChildren:()=>Promise.all([i.e(291),i.e(675)]).then(i.bind(i,675)).then(t=>t.CaptureDetailsPageModule)}];let v=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=p.oAB({type:t}),t.\u0275inj=p.cJS({imports:[[a.Bz.forChild(g)],a.Bz]}),t})(),A=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=p.oAB({type:t}),t.\u0275inj=p.cJS({imports:[[o.ez,r.u5,s.Pc,v]]}),t})()}}]);