(self.webpackChunkcap=self.webpackChunkcap||[]).push([[322],{322:(t,e,o)=>{"use strict";o.r(e),o.d(e,{RoutesPageModule:()=>D});var i=o(1116),s=o(1041),n=o(5394),r=o(3146),l=o(4762),c=o(8194),u=o(5614),a=o(5724),h=o(8579),g=o(1083),d=o(2590);function p(t,e){1&t&&(u.TgZ(0,"ion-chip",21),u.TgZ(1,"ion-label"),u._uU(2,"Active"),u.qZA(),u.qZA())}function Z(t,e){1&t&&(u.TgZ(0,"ion-chip",22),u.TgZ(1,"ion-label"),u._uU(2,"In-Progress"),u.qZA(),u.qZA())}function f(t,e){1&t&&(u.TgZ(0,"ion-chip",23),u.TgZ(1,"ion-label"),u._uU(2,"Completed"),u.qZA(),u.qZA())}function v(t,e){1&t&&(u.TgZ(0,"ion-chip",24),u.TgZ(1,"ion-label"),u._uU(2,"Checked-In"),u.qZA(),u.qZA())}function T(t,e){1&t&&(u.TgZ(0,"ion-chip",24),u.TgZ(1,"ion-label"),u._uU(2,"Checked-Out"),u.qZA(),u.qZA())}function S(t,e){1&t&&(u.TgZ(0,"ion-chip",22),u.TgZ(1,"ion-label"),u._uU(2,"Cancelled"),u.qZA(),u.qZA())}function A(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"ion-col",5),u.TgZ(1,"ion-card",6),u.TgZ(2,"ion-card-header",7),u.TgZ(3,"ion-row"),u.TgZ(4,"ion-col",8),u.TgZ(5,"ion-card-subtitle"),u._uU(6),u.ALo(7,"date"),u.qZA(),u.TgZ(8,"ion-card-subtitle"),u._uU(9),u.qZA(),u.TgZ(10,"ion-card-title",9),u._uU(11),u.qZA(),u.qZA(),u.TgZ(12,"ion-col",10),u.YNc(13,p,3,0,"ion-chip",11),u.YNc(14,Z,3,0,"ion-chip",12),u.YNc(15,f,3,0,"ion-chip",13),u.YNc(16,v,3,0,"ion-chip",14),u.YNc(17,T,3,0,"ion-chip",14),u.YNc(18,S,3,0,"ion-chip",12),u.qZA(),u.qZA(),u.qZA(),u.TgZ(19,"ion-card-content",15),u.TgZ(20,"ion-item",16),u.TgZ(21,"ion-label",17),u.TgZ(22,"b"),u._uU(23,"Trip"),u.qZA(),u.qZA(),u.TgZ(24,"ion-label",18),u._uU(25),u.qZA(),u.qZA(),u.TgZ(26,"ion-item",16),u.TgZ(27,"ion-label",17),u.TgZ(28,"b"),u._uU(29,"Total Stops"),u.qZA(),u.qZA(),u.TgZ(30,"ion-label",18),u._uU(31),u.qZA(),u.qZA(),u.TgZ(32,"ion-button",19),u.NdJ("click",function(){const e=u.CHM(t),o=e.$implicit,i=e.index;return u.oxw().onStart(o,i)}),u._UZ(33,"ion-icon",20),u._uU(34,"View Route "),u.qZA(),u.qZA(),u.qZA(),u.qZA()}if(2&t){const t=e.$implicit;u.xp6(6),u.Oqu(u.xi3(7,12,t.XDLVDAT_0,"mediumDate")),u.xp6(3),u.AsE("",t.XFCY_0," ",t.XFCYDES_0,""),u.xp6(2),u.Oqu(t.XDRN_0),u.xp6(2),u.Q6J("ngIf",1==t.XROUTSTAT_0),u.xp6(1),u.Q6J("ngIf",2==t.XROUTSTAT_0),u.xp6(1),u.Q6J("ngIf",3==t.XROUTSTAT_0),u.xp6(1),u.Q6J("ngIf",4==t.XROUTSTAT_0),u.xp6(1),u.Q6J("ngIf",5==t.XROUTSTAT_0),u.xp6(1),u.Q6J("ngIf",6==t.XROUTSTAT_0),u.xp6(7),u.Oqu(t.XTRIP_0),u.xp6(6),u.Oqu(t.DocCount)}}const m=[{path:"",component:(()=>{class t{constructor(t,e,o,i,s,n){this.utilService=t,this.routesService=e,this.route=o,this.router=i,this.events=s,this.authService=n,this.routes=[],this.route.queryParams.subscribe(t=>{const e=localStorage.getItem("podDriverId");t&&t.code?t.code==e?(this.utilService.setStorageData("driverCode",t.code),this.code=t.code,this.getRoutes()):this.authService.logout():(this.code=e,this.getRoutes())})}ngOnInit(){}getRoutes(){return(0,l.mG)(this,void 0,void 0,function*(){yield this.utilService.showLoading(),this.routesService.getRoutes(this.code).subscribe(t=>{this.completeWidgets(),t&&(this.routes=t,this.utilService.setStorageData("routes",this.routes),localStorage.removeItem("activeRouteId"),this.events.publish("routeId:change",null),(navigator.onLine||this.utilService.isOnline)&&this.getStops())},t=>{this.completeWidgets(),this.utilService.showErrorCall(t)})})}getStops(){var t;let e=[];for(let o=0;o<this.routes.length;o++)this.routesService.getStops(null===(t=this.routes[o])||void 0===t?void 0:t.XDRN_0).subscribe(t=>{var i;for(let s=0;s<t.length;s++)t[s].routeId=null===(i=this.routes[o])||void 0===i?void 0:i.XDRN_0,e.push(t[s]);o===this.routes.length-1&&(this.stopsData=e,this.documentsNPods(),this.utilService.setStorageData("stops",e))},t=>{this.utilService.showErrorCall(t)})}documentsNPods(){this.utilService.getStorageData("documentinfo").then(t=>{var e;if(t||(t=[]),this.stopsData.length>0)for(let o=0;o<this.stopsData.length;o++)this.routesService.getStopsDetails(null===(e=this.stopsData[o])||void 0===e?void 0:e.XDOCNUM_0).subscribe(e=>{var o;for(let i=0;i<e.length;i++){const s=c.findIndex(t,{XDOCNUM_0:null===(o=e[i])||void 0===o?void 0:o.XDOCNUM_0});s<0?t.push(e[i]):t[s]=e[i]}this.utilService.setStorageData("documentinfo",t)},t=>{this.utilService.showErrorCall(t)})}),this.utilService.getStorageData("documentdet").then(t=>{var e;if(t||(t=[]),this.stopsData.length>0)for(let o=0;o<this.stopsData.length;o++)this.routesService.getDocumentDetails(null===(e=this.stopsData[o])||void 0===e?void 0:e.XDOCNUM_0).subscribe(e=>{var o;for(let i=0;i<e.length;i++){const s=c.findIndex(t,{XDOCNUM_0:null===(o=e[i])||void 0===o?void 0:o.XDOCNUM_0});s<0?t.push(e[i]):t[s]=e[i]}this.utilService.setStorageData("documentdet",t)},t=>{this.utilService.showErrorCall(t)})}),this.utilService.getStorageData("poddet").then(t=>{var e;if(t||(t=[]),this.stopsData.length>0)for(let o=0;o<this.stopsData.length;o++)this.routesService.getPod(null===(e=this.stopsData[o])||void 0===e?void 0:e.XDOCNUM_0).subscribe(e=>{var o;for(let i=0;i<e.length;i++){const s=c.findIndex(t,{XDOCNUM_0:null===(o=e[i])||void 0===o?void 0:o.XDOCNUM_0});s<0?t.push(e[i]):t[s]=e[i]}this.utilService.setStorageData("poddet",t)},t=>{this.utilService.showErrorCall(t)})})}onStart(t,e){localStorage.setItem("activeRouteId",t.XDRN_0),this.events.publish("routeId:change",t.XDRN_0),this.router.navigate(["/tabs/stop-list"],{queryParams:{route:t.XDRN_0}})}logout(){this.utilService.showConfirmationPopup("Logout","Are you sure you want to logout?",t=>{1==t&&this.authService.logout()})}doRefresh(t){this.getRoutes()}completeWidgets(){this.utilService.dismissLoading(),this.pullToRefresh&&this.pullToRefresh.complete()}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(a.f),u.Y36(h._),u.Y36(r.gz),u.Y36(r.F0),u.Y36(g.z),u.Y36(d.e))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-routes"]],viewQuery:function(t,e){if(1&t&&u.Gf(n.nJ,5),2&t){let t;u.iGM(t=u.CRH())&&(e.pullToRefresh=t.first)}},decls:10,vars:3,consts:[["size","large","slot","end","name","log-out-outline",3,"click"],["color","tertiary"],["slot","fixed",3,"ionRefresh"],[1,"ion-margin-bottom"],["size-md","6","class","ion-no-padding",4,"ngFor","ngForOf"],["size-md","6",1,"ion-no-padding"],[1,"mb-0"],["color","dark",1,"p-8"],["size","7"],[1,"fs-12"],["size","5"],["color","warning","class","float-right",4,"ngIf"],["color","danger","class","float-right",4,"ngIf"],["color","success","class","float-right",4,"ngIf"],["color","secondary","class","float-right",4,"ngIf"],[1,"ion-no-padding"],["lines","full",1,"fs-14"],["color","primary"],["color","dark"],["color","primary","expand","block",1,"ion-margin",3,"click"],["slot","start","name","navigate-outline"],["color","warning",1,"float-right"],["color","danger",1,"float-right"],["color","success",1,"float-right"],["color","secondary",1,"float-right"]],template:function(t,e){1&t&&(u.TgZ(0,"ion-header"),u.TgZ(1,"ion-toolbar"),u.TgZ(2,"ion-title"),u._uU(3),u.qZA(),u.TgZ(4,"ion-icon",0),u.NdJ("click",function(){return e.logout()}),u.qZA(),u.qZA(),u.qZA(),u.TgZ(5,"ion-content",1),u.TgZ(6,"ion-refresher",2),u.NdJ("ionRefresh",function(t){return e.doRefresh(t)}),u._UZ(7,"ion-refresher-content",1),u.qZA(),u.TgZ(8,"ion-row",3),u.YNc(9,A,35,15,"ion-col",4),u.qZA(),u.qZA()),2&t&&(u.xp6(3),u.AsE("#",e.code," ",null==e.routes[0]?null:e.routes[0].XDRIVERNAM_0,""),u.xp6(6),u.Q6J("ngForOf",e.routes))},directives:[n.Gu,n.sr,n.wd,n.gu,n.W2,n.nJ,n.Wo,n.Nd,i.sg,n.wI,n.PM,n.Zi,n.tO,n.gZ,i.O5,n.FN,n.Ie,n.Q$,n.YG,n.hM],pipes:[i.uU],styles:[""]}),t})()}];let q=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[r.Bz.forChild(m)],r.Bz]}),t})(),D=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[i.ez,s.u5,n.Pc,q]]}),t})()}}]);