(self.webpackChunkcap=self.webpackChunkcap||[]).push([[7451],{7451:(t,e,i)=>{"use strict";i.r(e),i.d(e,{MapPageModule:()=>f});var s=i(1116),o=i(1041),n=i(5394),r=i(3146),l=i(4762),a=i(3523),p=i(8194),g=i(5614),c=i(5724),d=i(8579);function h(t,e){if(1&t&&(g.TgZ(0,"ion-slide"),g.TgZ(1,"ion-card",4),g.TgZ(2,"ion-card-header"),g.TgZ(3,"ion-card-subtitle"),g._uU(4),g.qZA(),g.qZA(),g.qZA(),g.qZA()),2&t){const t=e.$implicit;g.xp6(4),g.Oqu(t.XBPNAME_0)}}const u=[{path:"",component:(()=>{class t{constructor(t,e,i){this.route=t,this.utilService=e,this.routesService=i,this.infoWindow=new google.maps.InfoWindow,this.stops=[],this.swiperParams={slidesPerView:1,initialSlide:0},this.route.queryParams.subscribe(t=>{if(t&&t.route)this.routeId=t.route;else{const t=localStorage.getItem("activeRouteId");"null"!==t&&(this.routeId=t)}})}ionViewWillEnter(){setTimeout(()=>{this.initMap(null)},1e3)}ngOnInit(){}getStops(){return(0,l.mG)(this,void 0,void 0,function*(){yield this.utilService.showLoading(),this.routesService.getStops(this.routeId).subscribe(t=>{this.utilService.dismissLoading(),this.stops=p.sortBy(t,["XCSGNUM_0"]),this.setMarker()},t=>{this.utilService.dismissLoading(),this.utilService.showErrorCall(t)})})}initMap(t){this.directionsService=new google.maps.DirectionsService({optimizeWaypoints:!0}),this.directionsDisplay=new google.maps.DirectionsRenderer({polylineOptions:{strokeColor:"#009e71",strokeWeight:7}}),this.googleMap||(this.googleMap=new google.maps.Map(document.getElementById("map_canvas"),{mapTypeControl:!1,streetViewControl:!1,zoom:10,center:t?{lat:Number(t.latitude),lng:Number(t.longitude)}:{lat:0,lng:0},styles:a.M})),this.routeId&&this.getStops()}setMarker(){const t={url:"assets/images/pin.png",labelOrigin:new google.maps.Point(16,12)};if(new google.maps.Marker({position:{lat:Number(this.stops[0].X10A_FCYGEOY_0),lng:Number(this.stops[0].X10A_FCYGEOX_0)},map:this.googleMap,icon:"assets/images/home.png",label:{text:" ",fontSize:"15px",fontWeight:"bold",color:"#ffffff"}}),this.stops.map((e,i)=>{if(this.googleMap){const s=new google.maps.Marker({position:{lat:Number(e.XX10A_BPGEOY_0),lng:Number(e.XX10A_BPGEOX_0)},map:this.googleMap,icon:t,label:{text:i+1+"",fontSize:"15px",fontWeight:"bold",color:"#ffffff"},title:e.XBPNAME_0});s.addListener("click",()=>{this.slides.slideTo(i,0),this.googleMap.setZoom(15),this.googleMap.setCenter(s.getPosition()),this.infoWindow.close(),this.infoWindow.setContent(s.getTitle()),this.infoWindow.open(s.getMap(),s)})}return e}),this.stops&&this.stops.length>0)if(1===this.stops.length)this.googleMap.setCenter({lat:Number(this.stops[0].XX10A_BPGEOY_0),lng:Number(this.stops[0].XX10A_BPGEOX_0)});else{this.stops[0].type="start",this.stops[this.stops.length-1].type="end";const t=this.stops[0],e=p.find(this.stops,{type:"end"}),i=p.filter(this.stops,t=>"end"!==t.type).map(t=>({location:{lat:Number(t.XX10A_BPGEOY_0),lng:Number(t.XX10A_BPGEOX_0)}}));let s={origin:{lat:Number(t.X10A_FCYGEOY_0),lng:Number(t.X10A_FCYGEOX_0)},waypoints:i,destination:{lat:Number(e.XX10A_BPGEOY_0),lng:Number(e.XX10A_BPGEOX_0)},travelMode:google.maps.DirectionsTravelMode.DRIVING};this.directionsService.route(s,(t,e)=>{e==google.maps.DirectionsStatus.OK&&(this.directionsDisplay.setDirections(t),this.directionsDisplay.setMap(this.googleMap),this.directionsDisplay.setOptions({suppressMarkers:!0}))})}}sliderChanges(t){var e;return(0,l.mG)(this,void 0,void 0,function*(){yield this.slides.getActiveIndex().then(t=>{this.currentIndex=t}),this.currentEvent=this.stops[this.currentIndex],this.googleMap.setCenter({lat:Number(this.currentEvent.XX10A_BPGEOY_0),lng:Number(null===(e=this.currentEvent)||void 0===e?void 0:e.XX10A_BPGEOX_0)})})}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(r.gz),g.Y36(c.f),g.Y36(d._))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-map"]],viewQuery:function(t,e){if(1&t&&g.Gf(n.Hr,5),2&t){let t;g.iGM(t=g.CRH())&&(e.slides=t.first)}},decls:5,vars:2,consts:[["id","map_canvas",1,"google-map","h-100"],[1,"map-slides"],[1,"ion-slides",3,"options","ionSlideDidChange"],[4,"ngFor","ngForOf"],[1,"slide-card"]],template:function(t,e){1&t&&(g.TgZ(0,"ion-content"),g._UZ(1,"div",0),g.TgZ(2,"div",1),g.TgZ(3,"ion-slides",2),g.NdJ("ionSlideDidChange",function(t){return e.sliderChanges(t)}),g.YNc(4,h,5,1,"ion-slide",3),g.qZA(),g.qZA(),g.qZA()),2&t&&(g.xp6(3),g.Q6J("options",e.swiperParams),g.xp6(1),g.Q6J("ngForOf",e.stops))},directives:[n.W2,n.Hr,s.sg,n.A$,n.PM,n.Zi,n.tO],styles:[".google-map[_ngcontent-%COMP%]{position:relative}.map-slides[_ngcontent-%COMP%]{position:absolute;bottom:10px;text-align:center;width:calc(100%)}.map-slides[_ngcontent-%COMP%]   .ion-slides[_ngcontent-%COMP%]   .swiper-slide.swiper-slide-active[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{border-style:solid;border-color:var(--ion-color-primary)}.map-slides[_ngcontent-%COMP%]   .ion-slides[_ngcontent-%COMP%]   .slide-card[_ngcontent-%COMP%]{width:80%;height:20%}"]}),t})()}];let m=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[r.Bz.forChild(u)],r.Bz]}),t})(),f=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[s.ez,o.u5,n.Pc,m]]}),t})()}}]);