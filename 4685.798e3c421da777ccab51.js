(self.webpackChunkcap=self.webpackChunkcap||[]).push([[4685],{4685:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CancelStopPageModule:()=>R});var s=i(1116),o=i(1041),n=i(5394),c=i(3146),a=i(4762),l=i(9609),r=i(291),d=i(529),u=i(5614),p=i(5724),h=i(8579);function g(e,t){if(1&e&&(u.TgZ(0,"ion-select-option",17),u._uU(1),u.qZA()),2&e){const e=t.$implicit;u.Q6J("value",e.IDENT2_0),u.xp6(1),u.hij("",e.TEXTE_0," ")}}function m(e,t){1&e&&(u.TgZ(0,"p",19),u._uU(1," Select reason. "),u.qZA())}function f(e,t){if(1&e&&(u.TgZ(0,"ion-text"),u.YNc(1,m,2,0,"p",18),u.qZA()),2&e){u.oxw();const e=u.MAs(8);u.xp6(1),u.Q6J("ngIf",e.invalid&&e.errors.required)}}const x=function(e){return{"full-width":e}};function Z(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-col",9),u.TgZ(1,"ion-text"),u.TgZ(2,"h6",10),u._uU(3,"Reason"),u.qZA(),u.qZA(),u.TgZ(4,"ion-item",11),u.TgZ(5,"ion-label",12),u._uU(6,"Select Reason"),u.qZA(),u.TgZ(7,"ion-select",13,14),u.NdJ("ngModelChange",function(t){return u.CHM(e),u.oxw().reschedstopModel.reason=t}),u.YNc(9,g,2,2,"ion-select-option",15),u.qZA(),u.qZA(),u.YNc(10,f,2,1,"ion-text",16),u.qZA()}if(2&e){const e=u.MAs(8),t=u.oxw();u.xp6(5),u.Q6J("hidden",t.reschedstopModel.reason),u.xp6(2),u.Q6J("ngClass",u.VKq(5,x,t.reschedstopModel.reason))("ngModel",t.reschedstopModel.reason),u.xp6(2),u.Q6J("ngForOf",t.reschedReasons),u.xp6(1),u.Q6J("ngIf",t.submitted&&e.invalid)}}function A(e,t){1&e&&(u.TgZ(0,"p",19),u._uU(1," Select date and time. "),u.qZA())}function T(e,t){if(1&e&&(u.TgZ(0,"ion-text"),u.YNc(1,A,2,0,"p",18),u.qZA()),2&e){u.oxw();const e=u.MAs(8);u.xp6(1),u.Q6J("ngIf",e.invalid&&e.errors.required)}}function v(e,t){1&e&&(u.TgZ(0,"ion-text"),u.TgZ(1,"p",19),u._uU(2," Select valid date. "),u.qZA(),u.qZA())}function M(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-col",20),u.TgZ(1,"ion-text"),u.TgZ(2,"h6",10),u._uU(3,"Reschedule Date"),u.qZA(),u.qZA(),u.TgZ(4,"ion-item",11),u.TgZ(5,"ion-label",12),u._uU(6,"Select Date"),u.qZA(),u.TgZ(7,"ion-datetime",21,22),u.NdJ("ionChange",function(){return u.CHM(e),u.oxw().checkCusVal()})("ngModelChange",function(t){return u.CHM(e),u.oxw().reschedstopModel.reschedule_date=t}),u.qZA(),u.qZA(),u.YNc(9,T,2,1,"ion-text",16),u.YNc(10,v,3,0,"ion-text",16),u.qZA()}if(2&e){const e=u.MAs(8),t=u.oxw();u.xp6(5),u.Q6J("hidden",t.reschedstopModel.reschedule_date),u.xp6(2),u.Q6J("min",t.minDateTime)("max",t.maxDateTime)("ngModel",t.reschedstopModel.reschedule_date),u.xp6(2),u.Q6J("ngIf",t.submitted&&e.invalid),u.xp6(1),u.Q6J("ngIf",!t.isCustVal)}}function y(e,t){if(1&e&&(u.TgZ(0,"ion-select-option",17),u._uU(1),u.qZA()),2&e){const e=t.$implicit;u.Q6J("value",e.IDENT2_0),u.xp6(1),u.hij("",e.TEXTE_0," ")}}function q(e,t){1&e&&(u.TgZ(0,"p",19),u._uU(1," Select reason. "),u.qZA())}function C(e,t){if(1&e&&(u.TgZ(0,"ion-text"),u.YNc(1,q,2,0,"p",18),u.qZA()),2&e){u.oxw();const e=u.MAs(8);u.xp6(1),u.Q6J("ngIf",e.invalid&&e.errors.required)}}function S(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-col",9),u.TgZ(1,"ion-text"),u.TgZ(2,"h6",10),u._uU(3,"Reason"),u.qZA(),u.qZA(),u.TgZ(4,"ion-item",11),u.TgZ(5,"ion-label",12),u._uU(6,"Select Reason"),u.qZA(),u.TgZ(7,"ion-select",23,14),u.NdJ("ngModelChange",function(t){return u.CHM(e),u.oxw().cancelstopModel.reason=t}),u.YNc(9,y,2,2,"ion-select-option",15),u.qZA(),u.qZA(),u.YNc(10,C,2,1,"ion-text",16),u.qZA()}if(2&e){const e=u.MAs(8),t=u.oxw();u.xp6(5),u.Q6J("hidden",t.cancelstopModel.reason),u.xp6(2),u.Q6J("ngClass",u.VKq(5,x,t.cancelstopModel.reason))("ngModel",t.cancelstopModel.reason),u.xp6(2),u.Q6J("ngForOf",t.cancelReasons),u.xp6(1),u.Q6J("ngIf",t.submitted&&e.invalid)}}function b(e,t){1&e&&(u.TgZ(0,"p",19),u._uU(1," Reason for rescheduleling comment is required. "),u.qZA())}function w(e,t){if(1&e&&(u.TgZ(0,"ion-text"),u.YNc(1,b,2,0,"p",18),u.qZA()),2&e){u.oxw();const e=u.MAs(6);u.xp6(1),u.Q6J("ngIf",e.invalid&&e.errors.required)}}function N(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-col",9),u.TgZ(1,"ion-text"),u.TgZ(2,"h6",10),u._uU(3,"Comment"),u.qZA(),u.qZA(),u.TgZ(4,"ion-item",24),u.TgZ(5,"ion-textarea",25,26),u.NdJ("ngModelChange",function(t){return u.CHM(e),u.oxw().reschedstopModel.comment=t}),u.qZA(),u.qZA(),u.YNc(7,w,2,1,"ion-text",16),u.qZA()}if(2&e){const e=u.MAs(6),t=u.oxw();u.xp6(5),u.Q6J("ngModel",t.reschedstopModel.comment),u.xp6(2),u.Q6J("ngIf",t.submitted&&e.invalid)}}function Y(e,t){1&e&&(u.TgZ(0,"p",19),u._uU(1," Reason for cancelling comment is required. "),u.qZA())}function _(e,t){if(1&e&&(u.TgZ(0,"ion-text"),u.YNc(1,Y,2,0,"p",18),u.qZA()),2&e){u.oxw();const e=u.MAs(6);u.xp6(1),u.Q6J("ngIf",e.invalid&&e.errors.required)}}function J(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-col",9),u.TgZ(1,"ion-text"),u.TgZ(2,"h6",10),u._uU(3,"Comment"),u.qZA(),u.qZA(),u.TgZ(4,"ion-item",24),u.TgZ(5,"ion-textarea",25,26),u.NdJ("ngModelChange",function(t){return u.CHM(e),u.oxw().cancelstopModel.comment=t}),u.qZA(),u.qZA(),u.YNc(7,_,2,1,"ion-text",16),u.qZA()}if(2&e){const e=u.MAs(6),t=u.oxw();u.xp6(5),u.Q6J("ngModel",t.cancelstopModel.comment),u.xp6(2),u.Q6J("ngIf",t.submitted&&e.invalid)}}const I=`\n      <codeLang xsi:type="xsd:string">${d.N.soapLanguage}</codeLang>\n      <poolAlias xsi:type="xsd:string">${d.N.soapPoolAlias}</poolAlias>\n      <poolId xsi:type="xsd:string">?</poolId>\n      <requestConfig xsi:type="xsd:string">?</requestConfig>\n`,Q=[{path:"",component:(()=>{class e{constructor(e,t,i,s,o){this.utilService=e,this.router=t,this.route=i,this.routesService=s,this.soap=o,this.submitted=!1,this.cancelstopModel={cancel_type:"cancel",comment:""},this.reschedstopModel={cancel_type:"reschedule",comment:""},this.displayType="",this.minDateTime=l().add(1,"day").format(),this.maxDateTime=l().add(10,"year").format(),this.isCustVal=!0,this.route.queryParams.subscribe(e=>{e&&e.docNo&&(this.docNo=e.docNo,this.displayType=e.displayType,this.cus_name=e.cus_name,this.cus_code=e.cus_code)})}ngOnInit(){return(0,a.mG)(this,void 0,void 0,function*(){"cancelStop"==this.displayType&&this.getCancelReasons(),"rescheduleStop"==this.displayType&&(this.rescheduleReasons(),this.customerAvailable())})}getCancelReasons(){return(0,a.mG)(this,void 0,void 0,function*(){yield this.utilService.showLoading(),this.routesService.cancelReasons().subscribe(e=>{this.cancelReasons=e,this.utilService.dismissLoading()},e=>{this.utilService.dismissLoading(),this.utilService.showErrorCall(e)})})}rescheduleReasons(){return(0,a.mG)(this,void 0,void 0,function*(){yield this.utilService.showLoading(),this.routesService.rescheduleReasons().subscribe(e=>{this.reschedReasons=e,this.utilService.dismissLoading()},e=>{this.utilService.dismissLoading(),this.utilService.showErrorCall(e)})})}checkCusVal(){const e=l(this.reschedstopModel.reschedule_date).day();let t=Object.values(this.custAvail);0==e?2==t[6]?this.isCustVal=!0:1==t[6]&&(this.isCustVal=!1):2==t[e-1]?this.isCustVal=!0:1==t[e-1]&&(this.isCustVal=!1)}customerAvailable(){this.routesService.customerAvailable({CustCode:this.cus_code}).subscribe(e=>{this.custAvail=e[0]},e=>{this.utilService.showErrorCall(e)})}onSubmit(e){this.submitted=!0,e.valid&&("cancelStop"==this.displayType&&this.utilService.showConfirmationPopup("Confirmation","Are you sure you want to cancel this stop",e=>(0,a.mG)(this,void 0,void 0,function*(){if(1==e){this.cancelstopModel.doc=this.docNo;const e=l().format("YYYY-MM-DDTHH:mm:ss");let t=localStorage.getItem("activeRouteId");this.cancelstopModel.datetime=e,this.cancelstopModel.route_no=t,yield this.utilService.showLoading(),this.routesService.postCancelRoute(this.cancelstopModel).subscribe(e=>{this.utilService.dismissLoading(),this.router.navigate(["/tabs/stop-list"],{queryParams:{route:t}})},e=>{this.utilService.dismissLoading(),this.utilService.showErrorCall(e)})}})),"rescheduleStop"==this.displayType&&this.isCustVal&&this.utilService.showConfirmationPopup("Confirmation","Are you sure you want to reschedule this stop",e=>(0,a.mG)(this,void 0,void 0,function*(){if(1==e){const e={doc:this.docNo,datetime:l(this.reschedstopModel.reschedule_date).format("YYYY-MM-DDTHH:mm:ss")};this.routesService.docReschedule(e).subscribe(e=>{},e=>{this.utilService.showErrorCall(e)});let t=`\n            <![CDATA[<PARAM>\n              <GRP ID="SDH1_1">\n                <FLD NAME="DLVDAT" TYPE="Date">${l(this.reschedstopModel.reschedule_date).format("YYYYMMDD")}</FLD>\n              </GRP>\n            </PARAM>]]>`;yield this.utilService.showLoading(),this.soap.createClient(d.N.soap+"/soap-wsdl/syracuse/collaboration/syracuse/CAdxWebServiceXmlCC?wsdl",{attributesKey:"attributes",valueKey:"$value",xmlKey:"$xml"}).then(e=>{e.setSecurity(new r.t7.BasicAuthSecurity(d.N.soapUsername,d.N.soapPassword,"")),e.call("modify",{callContext:{$xml:I,attributes:{"xsi:type":"wss:CAdxCallContext"}},publicName:{attributes:{"xsi:type":"xsd:string"},$value:"XX10ASDH"},objectKeys:{attributes:{"xsi:type":"wss:ArrayOfCAdxParamKeyValue","soapenc:arrayType":"wss:CAdxParamKeyValue[]"},key:{$value:"SDHNUM"},value:{$value:`${this.docNo}`}},objectXml:{attributes:{"xsi:type":"xsd:string"},$xml:t}}).subscribe(e=>{this.utilService.dismissLoading();let t=localStorage.getItem("activeRouteId");this.router.navigate(["/tabs/stop-list"],{queryParams:{route:t}})},e=>{console.log(e),this.utilService.showToast(),this.utilService.dismissLoading()})}).catch(e=>{console.log(e),this.utilService.showToast(),this.utilService.dismissLoading()})}})))}}return e.\u0275fac=function(t){return new(t||e)(u.Y36(p.f),u.Y36(c.F0),u.Y36(c.gz),u.Y36(h._),u.Y36(r.Ey))},e.\u0275cmp=u.Xpm({type:e,selectors:[["app-cancel-stop"]],decls:17,vars:8,consts:[["color","dark"],["slot","start"],[1,"header-title"],["color","tertiary",1,"ion-padding"],["novalidate","",3,"ngSubmit"],["cancelstopForm","ngForm"],["size-xs","12","size-sm","12","size-md","6",4,"ngIf"],["size-md","6",4,"ngIf"],["type","submit","color","warning","expand","block","shape","round",1,"mt-3",3,"disabled"],["size-xs","12","size-sm","12","size-md","6"],[1,"mt-3","pb-1"],["lines","full",1,"mt-2"],[3,"hidden"],["name","reason","value","brown","okText","Okay","cancelText","Dismiss","required","",1,"",3,"ngClass","ngModel","ngModelChange"],["reason","ngModel"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"value"],["class","error-msg",4,"ngIf"],[1,"error-msg"],["size-md","6"],["name","date","display-format","DD.MM.YYYY","required","",2,"padding-inline-start","0px",3,"min","max","ngModel","ionChange","ngModelChange"],["rescheduleDate","ngModel"],["name","reason","value","brown","okText","Okay","cancelText","Dismiss","required","",3,"ngClass","ngModel","ngModelChange"],["lines","full"],["name","comment","placeholder","Enter here...","rows","4","required","",3,"ngModel","ngModelChange"],["comment","ngModel"]],template:function(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-header"),u.TgZ(1,"ion-toolbar",0),u.TgZ(2,"ion-buttons",1),u._UZ(3,"ion-back-button"),u.qZA(),u.TgZ(4,"ion-title",2),u._uU(5),u.qZA(),u.qZA(),u.qZA(),u.TgZ(6,"ion-content",3),u.TgZ(7,"form",4,5),u.NdJ("ngSubmit",function(){u.CHM(e);const i=u.MAs(8);return t.onSubmit(i)}),u.TgZ(9,"ion-row"),u.YNc(10,Z,11,7,"ion-col",6),u.YNc(11,M,11,6,"ion-col",7),u.YNc(12,S,11,7,"ion-col",6),u.YNc(13,N,8,2,"ion-col",6),u.YNc(14,J,8,2,"ion-col",6),u.qZA(),u.TgZ(15,"ion-button",8),u._uU(16," Confirm "),u.qZA(),u.qZA(),u.qZA()}2&e&&(u.xp6(5),u.AsE("",t.cus_name," - ",t.docNo,""),u.xp6(5),u.Q6J("ngIf","rescheduleStop"==t.displayType),u.xp6(1),u.Q6J("ngIf","rescheduleStop"==t.displayType),u.xp6(1),u.Q6J("ngIf","cancelStop"==t.displayType),u.xp6(1),u.Q6J("ngIf","rescheduleStop"==t.displayType),u.xp6(1),u.Q6J("ngIf","cancelStop"==t.displayType),u.xp6(1),u.Q6J("disabled",!t.isCustVal))},directives:[n.Gu,n.sr,n.Sm,n.oU,n.cs,n.wd,n.W2,o._Y,o.JL,o.F,n.Nd,s.O5,n.YG,n.wI,n.yW,n.Ie,n.Q$,n.t9,n.QI,o.Q7,s.mk,o.JJ,o.On,s.sg,n.n0,n.x4,n.g2,n.j9],styles:[".header-title[_ngcontent-%COMP%]{display:inherit}"]}),e})()}];let D=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=u.oAB({type:e}),e.\u0275inj=u.cJS({imports:[[c.Bz.forChild(Q)],c.Bz]}),e})(),R=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=u.oAB({type:e}),e.\u0275inj=u.cJS({imports:[[s.ez,o.u5,n.Pc,D]]}),e})()}}]);