(self.webpackChunkcap=self.webpackChunkcap||[]).push([[4163],{4163:(t,e,o)=>{"use strict";o.r(e),o.d(e,{StopDetailPageModule:()=>P});var s=o(1116),i=o(1041),n=o(5394),l=o(3146),r=o(4762),c=o(3523),a=o(5614),p=o(5724);function u(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"ion-item",0),a.NdJ("click",function(){return a.CHM(t),a.oxw().skipStop()}),a._uU(1,"Skip"),a.qZA()}}function d(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"ion-item",0),a.NdJ("click",function(){return a.CHM(t),a.oxw().cancelStop()}),a._uU(1,"Cancel"),a.qZA()}}function h(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"ion-item",0),a.NdJ("click",function(){return a.CHM(t),a.oxw().rescheduleStop()}),a._uU(1,"Reschedule"),a.qZA()}}let m=(()=>{class t{constructor(t,e,o){this.router=t,this.popoverController=e,this.utilService=o,this.currentStop=[]}ngOnInit(){}showPreview(){6==this.status?(this.popoverController.dismiss(),this.router.navigate(["/tabs/stop-list/stop-detail/pod-report"],{queryParams:{podrep:this.stopId}})):this.utilService.showToast("First complete product delivery.")}skipStop(){this.isActiveStop?this.utilService.showToast("Complete active stop fisrt."):(this.popoverController.dismiss(),this.router.navigate(["/tabs/stop-list/skip-stop"],{queryParams:{docNo:this.stopId,cus_name:this.cus_name,cus_code:this.cus_code}}))}cancelStop(){this.popoverController.dismiss(),this.router.navigate(["/tabs/stop-list/cancel-stop"],{queryParams:{docNo:this.stopId,displayType:"cancelStop",cus_name:this.cus_name,cus_code:this.cus_code}})}rescheduleStop(){this.popoverController.dismiss(),this.router.navigate(["/tabs/stop-list/cancel-stop"],{queryParams:{docNo:this.stopId,displayType:"rescheduleStop",cus_name:this.cus_name,cus_code:this.cus_code}})}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(l.F0),a.Y36(n.Dh),a.Y36(p.f))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-action-popover"]],decls:6,vars:3,consts:[["button","",3,"click"],["button","",3,"click",4,"ngIf"]],template:function(t,e){1&t&&(a.TgZ(0,"ion-list"),a.TgZ(1,"ion-item",0),a.NdJ("click",function(){return e.showPreview()}),a._uU(2,"Preview / Email"),a.qZA(),a.YNc(3,u,2,0,"ion-item",1),a.YNc(4,d,2,0,"ion-item",1),a.YNc(5,h,2,0,"ion-item",1),a.qZA()),2&t&&(a.xp6(3),a.Q6J("ngIf",5!==e.status&&6!==e.status),a.xp6(1),a.Q6J("ngIf",6!==e.status),a.xp6(1),a.Q6J("ngIf",6!==e.status))},directives:[n.q_,n.Ie,s.O5],styles:[""]}),t})();var S=o(9609),g=o(8194),_=o(3148),f=o(878),T=o(7727),v=o(8579);const A=function(){return["/tabs/stop-list/stop-detail/document-detail"]},Z=function(t){return{document:t}};function X(t,e){if(1&t&&(a.TgZ(0,"ion-item",13),a._UZ(1,"ion-icon",14),a.TgZ(2,"ion-label"),a._uU(3,"Document Details"),a.qZA(),a.qZA()),2&t){const t=e.$implicit;a.Q6J("routerLink",a.DdM(2,A))("queryParams",a.VKq(3,Z,t.XDOCNUM_0))}}function C(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"ion-card",15),a.TgZ(1,"ion-card-content",16),a.TgZ(2,"ion-item",17),a._UZ(3,"ion-icon",18),a.TgZ(4,"ion-text"),a.TgZ(5,"p",19),a._uU(6),a.qZA(),a.qZA(),a.qZA(),a.TgZ(7,"ion-item",17),a.TgZ(8,"ion-icon",20),a.NdJ("click",function(){return a.CHM(t),a.oxw().tel()}),a.qZA(),a.TgZ(9,"ion-text"),a.TgZ(10,"p",19),a._uU(11),a.qZA(),a.qZA(),a.qZA(),a.TgZ(12,"ion-item",17),a.TgZ(13,"ion-icon",21),a.NdJ("click",function(){return a.CHM(t),a.oxw().mail()}),a.qZA(),a.TgZ(14,"ion-text"),a.TgZ(15,"p",19),a._uU(16),a.qZA(),a.qZA(),a.qZA(),a.TgZ(17,"ion-item",17),a._UZ(18,"ion-icon",22),a.TgZ(19,"ion-text"),a.TgZ(20,"p",19),a._uU(21),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&t){const t=e.$implicit;a.xp6(6),a.AsE(" ",t.XBPCORD_0," - ",t.XBPNAME_0," "),a.xp6(5),a.Oqu(" "==t.XMOB_0?"-":t.XMOB_0),a.xp6(5),a.Oqu(" "==t.XWEB_0?"-":t.XWEB_0),a.xp6(5),a.gL8(" ",t.XBPAADDLIG_0," ",t.XBPAADDLIG_1," ",t.XBPAADDLIG_2," ",t.XPOSCOD_0," ",t.XCTY_0," ",t.XCRY_0," ")}}function D(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"ion-col",23),a.TgZ(1,"ion-button",24),a.NdJ("click",function(){a.CHM(t);const e=a.oxw();return e.skipStop(e.stopsDetails[0].XDOCNUM_0)}),a._UZ(2,"ion-icon",25),a.TgZ(3,"ion-label",26),a._uU(4,"Skip"),a.qZA(),a.qZA(),a.qZA()}}function U(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"ion-col",27),a.TgZ(1,"ion-button",28),a.NdJ("click",function(){return a.CHM(t),a.oxw().startRoute()}),a._UZ(2,"ion-icon",29),a.TgZ(3,"ion-label",26),a._uU(4,"Start Route"),a.qZA(),a.qZA(),a.qZA()}if(2&t){const t=a.oxw();a.Q6J("size",t.selectedStop&&5==t.selectedStop.XSTATUS_0?12:6)}}function q(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"ion-col",30),a.TgZ(1,"ion-button",31),a.NdJ("click",function(){a.CHM(t);const e=a.oxw();return e.onPODClick(e.stopsDetails[0].XDOCNUM_0)}),a._UZ(2,"ion-icon",32),a.TgZ(3,"ion-label",26),a._uU(4,"POD"),a.qZA(),a.qZA(),a.qZA()}}const M=[{path:"",component:(()=>{class t{constructor(t,e,o,s,i){this.popoverController=t,this.routesService=e,this.route=o,this.utilService=s,this.router=i,this.stopsDetails=[],this.stopList=[],this.isStopActive=!1,this.route.queryParams.subscribe(t=>{t&&t.stop&&(this.utilService.setStorageData("stopId",t.stop),this.stopId=t.stop,this.getStopsWithList())})}ngOnInit(){}getStopsWithList(){return(0,r.mG)(this,void 0,void 0,function*(){let t=localStorage.getItem("activeRouteId");yield this.utilService.showLoading(),(0,_.D)({stopDetails:this.routesService.getStopsDetails(this.stopId),stopList:this.routesService.getStops(t).pipe((0,T.K)(t=>(0,f.of)(null)))}).subscribe(t=>{this.utilService.dismissLoading(),this.stopsDetails=t.stopDetails,this.initMap();const e=g.filter(t.stopList,{XISACTIVDOC_0:2});this.isStopActive=e.length>0,this.stopList=g.sortBy(t.stopList,"XCSGNUM_0"),this.selectedStop=g.find(t.stopList,{XDOCNUM_0:this.stopId})},t=>{this.utilService.dismissLoading(),this.utilService.showErrorCall(t)})})}onPODClick(t){var e,o;const s=0==(null===(e=g.find(this.stopList,{XDOCNUM_0:t}))||void 0===e?void 0:e.XISACTIVDOC_0);if(this.isStopActive&&s)this.utilService.showToast("Complete active stop fisrt.");else if((null===(o=this.selectedStop)||void 0===o?void 0:o.XCSGNUM_0)>1){let e=g.find(this.stopList,{XCSGNUM_0:this.selectedStop.XCSGNUM_0-1});if(e&&5!==e.XSTATUS_0&&6!==e.XSTATUS_0&&"2"===e.Sequence)return this.utilService.showToast("Complete above stops first."),!1;this.router.navigate(["/tabs/stop-list/stop-detail/pod"],{queryParams:{poddet:t}})}else this.router.navigate(["/tabs/stop-list/stop-detail/pod"],{queryParams:{poddet:t}})}startRoute(){if(this.selectedStop.XCSGNUM_0>1){let t=g.find(this.stopList,{XCSGNUM_0:this.selectedStop.XCSGNUM_0-1});if(t&&5!==t.XSTATUS_0&&6!==t.XSTATUS_0&&"2"===t.Sequence)return this.utilService.showToast("Complete above stops first."),!1;this.commonStartRouteCheck()}else this.commonStartRouteCheck()}commonStartRouteCheck(){4==this.selectedStop.XSTATUS_0||6==this.selectedStop.XSTATUS_0?this.utilService.showToast("Route is already started!"):this.utilService.showConfirmationPopup("Confirmation","Are you sure you want to start route?",t=>{if(1==t){const t={datetime:S().format("YYYY-MM-DDTHH:mm:ss"),doc:this.selectedStop.XDOCNUM_0};this.routesService.getStartRoute(t).subscribe(t=>{-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPad")||-1!=navigator.platform.indexOf("iPod")?window.open("maps://maps.google.com/maps?daddr="+this.selectedStop.XX10A_BPGEOY_0+","+this.selectedStop.XX10A_BPGEOX_0+"&amp;ll="):window.open("https://maps.google.com/maps?daddr="+this.selectedStop.XX10A_BPGEOY_0+","+this.selectedStop.XX10A_BPGEOX_0+"&saddr=Your Location")},t=>{this.utilService.showErrorCall(t)})}})}initMap(){this.googleMap||(this.googleMap=new google.maps.Map(document.getElementById("detailMapCanvas"),{mapTypeControl:!1,streetViewControl:!1,zoom:15,center:{lat:Number(this.stopsDetails[0].XX10A_BPGEOY_0),lng:Number(this.stopsDetails[0].XX10A_BPGEOX_0)},styles:c.M}),this.marker=new google.maps.Marker({map:this.googleMap,position:{lat:Number(this.stopsDetails[0].XX10A_BPGEOY_0),lng:Number(this.stopsDetails[0].XX10A_BPGEOX_0)},icon:"assets/images/pin-green.png"}))}presentPopover(t,e,o,s){var i;return(0,r.mG)(this,void 0,void 0,function*(){const n=0==(null===(i=g.find(this.stopList,{XDOCNUM_0:e}))||void 0===i?void 0:i.XISACTIVDOC_0);let l;l=!(!this.isStopActive||!n);const r=yield this.popoverController.create({component:m,event:t,translucent:!1,componentProps:{status:this.selectedStop.XSTATUS_0,stopId:this.selectedStop.XDOCNUM_0,isActiveStop:l,cus_name:o,cus_code:s}});yield r.present()})}skipStop(t){var e;const o=0==g.find(this.stopList,{XDOCNUM_0:t}).XISACTIVDOC_0;if(this.isStopActive&&o)this.utilService.showToast("Complete active stop fisrt.");else if((null===(e=this.selectedStop)||void 0===e?void 0:e.XCSGNUM_0)>1){let t=g.find(this.stopList,{XCSGNUM_0:this.selectedStop.XCSGNUM_0-1});if(t&&5!==t.XSTATUS_0&&6!==t.XSTATUS_0&&"2"===t.Sequence)return this.utilService.showToast("Complete above stops first."),!1;5==this.selectedStop.XSTATUS_0||6==this.selectedStop.XSTATUS_0?this.utilService.showToast("Already skipped!"):this.router.navigate(["/tabs/stop-list/skip-stop"],{queryParams:{docNo:this.stopsDetails[0].XDOCNUM_0}})}else 5==this.selectedStop.XSTATUS_0||6==this.selectedStop.XSTATUS_0?this.utilService.showToast("Already skipped!"):this.router.navigate(["/tabs/stop-list/skip-stop"],{queryParams:{docNo:this.stopsDetails[0].XDOCNUM_0}})}tel(){window.location.href=`tel:${this.stopsDetails[0].XMOB_0}`}mail(){window.location.href=`mailto:${this.stopsDetails[0].XWEB_0}`}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(n.Dh),a.Y36(v._),a.Y36(l.gz),a.Y36(p.f),a.Y36(l.F0))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-stop-detail"]],decls:17,vars:6,consts:[["color","dark"],["slot","start"],["slot","end"],[3,"click"],["slot","icon-only","name","ellipsis-vertical",1,"fs-20"],["color","tertiary"],["id","detailMapCanvas",1,"map-section"],["color","primary","lines","none",3,"routerLink","queryParams",4,"ngFor","ngForOf"],["class","m-3",4,"ngFor","ngForOf"],[1,"px-2"],["size","6",4,"ngIf"],[3,"size",4,"ngIf"],["size","12",4,"ngIf"],["color","primary","lines","none",3,"routerLink","queryParams"],["slot","start","name","document-text-outline"],[1,"m-3"],[1,"py-2"],["lines","none",1,"ion-no-padding"],["slot","start","name","home-outline","color","primary",1,"fs-20"],[1,"fs-16"],["slot","start","name","call-outline","color","primary",1,"fs-20",3,"click"],["slot","start","name","mail-outline","color","primary",1,"fs-20",3,"click"],["slot","start","name","location-outline","color","primary",1,"fs-20"],["size","6"],["color","warning","expand","block",1,"mt-0",3,"click"],["name","arrow-redo-outline"],[1,"pl-1"],[3,"size"],["color","secondary","expand","block",1,"mt-0",3,"click"],["name","navigate-outline"],["size","12"],["color","dark","expand","block",1,"mt-0",3,"click"],["name","checkmark-done-outline"]],template:function(t,e){1&t&&(a.TgZ(0,"ion-header"),a.TgZ(1,"ion-toolbar",0),a.TgZ(2,"ion-buttons",1),a._UZ(3,"ion-back-button"),a.qZA(),a.TgZ(4,"ion-title"),a._uU(5),a.qZA(),a.TgZ(6,"ion-buttons",2),a.TgZ(7,"ion-button",3),a.NdJ("click",function(t){return e.presentPopover(t,null==e.stopsDetails[0]?null:e.stopsDetails[0].XDOCNUM_0,null==e.stopsDetails[0]?null:e.stopsDetails[0].XBPNAME_0,null==e.stopsDetails[0]?null:e.stopsDetails[0].XBPCORD_0)}),a._UZ(8,"ion-icon",4),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.TgZ(9,"ion-content",5),a._UZ(10,"div",6),a.YNc(11,X,4,5,"ion-item",7),a.YNc(12,C,22,10,"ion-card",8),a.TgZ(13,"ion-row",9),a.YNc(14,D,5,0,"ion-col",10),a.YNc(15,U,5,1,"ion-col",11),a.YNc(16,q,5,0,"ion-col",12),a.qZA(),a.qZA()),2&t&&(a.xp6(5),a.Oqu(null==e.stopsDetails[0]?null:e.stopsDetails[0].XDOCNUM_0),a.xp6(6),a.Q6J("ngForOf",e.stopsDetails),a.xp6(1),a.Q6J("ngForOf",e.stopsDetails),a.xp6(2),a.Q6J("ngIf",e.selectedStop&&5!==e.selectedStop.XSTATUS_0&&6!==e.selectedStop.XSTATUS_0),a.xp6(1),a.Q6J("ngIf",e.selectedStop&&6!==e.selectedStop.XSTATUS_0),a.xp6(1),a.Q6J("ngIf",e.stopsDetails.length>0))},directives:[n.Gu,n.sr,n.Sm,n.oU,n.cs,n.wd,n.YG,n.gu,n.W2,s.sg,n.Nd,s.O5,n.Ie,n.YI,l.rH,n.Q$,n.PM,n.FN,n.yW,n.wI],styles:[".map-section[_ngcontent-%COMP%]{height:30vh}"]}),t})()},{path:"document-detail",loadChildren:()=>Promise.all([o.e(291),o.e(7658)]).then(o.bind(o,7658)).then(t=>t.DocumentDetailPageModule)},{path:"pod",loadChildren:()=>o.e(5843).then(o.bind(o,5843)).then(t=>t.PodPageModule)},{path:"pod-report",loadChildren:()=>Promise.all([o.e(291),o.e(713)]).then(o.bind(o,713)).then(t=>t.PodReportPageModule)}];let N=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({imports:[[l.Bz.forChild(M)],l.Bz]}),t})(),P=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({imports:[[s.ez,i.u5,n.Pc,N]]}),t})()}}]);